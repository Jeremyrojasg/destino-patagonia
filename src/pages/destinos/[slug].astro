---
import { destinos } from "../../data/destinos";
import DestinoLayout from "../../layouts/DestinoLayout.astro";
import ImageGallery from "../../components/ImageGallery.astro";
import DestinoConsultaForm from "../../components/DestinoConsultaForm.astro";

export async function getStaticPaths() {
  return destinos.map(destino => ({
    params: { slug: destino.slug ?? slugify(destino.nombre) },
    props: { destino },
  }));
}

function slugify(text) {
  return text
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
}

const { destino } = Astro.props;

// SEO Metadata
const seoTitle = `${destino.nombre} - Destino Patagonia`;
const seoDescription = destino.metaDescripcion || destino.descripcion;
const seoImage = new URL(destino.imagen, Astro.site);

// JSON-LD Schema
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "TouristAttraction",
  "name": destino.nombre,
  "description": destino.descripcion,
  "image": seoImage.toString(),
  "url": new URL(destino.href, Astro.site).toString(),
  "address": {
    "@type": "PostalAddress",
    "addressRegion": "Chubut",
    "addressCountry": "Argentina"
  }
};
---

<DestinoLayout 
  frontmatter={{ 
    title: destino.nombre, 
    imagen: destino.imagen,
    coordinates: destino.coordinates,
    description: seoDescription,
    keywords: destino.keywords?.join(", ")
  }}
>
  <!-- SEO Meta Tags -->
  <meta slot="head" name="description" content={seoDescription} />
  <meta slot="head" name="keywords" content={destino.keywords?.join(", ")} />
  
  <!-- Open Graph -->
  <meta slot="head" property="og:title" content={seoTitle} />
  <meta slot="head" property="og:description" content={seoDescription} />
  <meta slot="head" property="og:image" content={seoImage} />
  <meta slot="head" property="og:url" content={new URL(destino.href, Astro.site)} />
  <meta slot="head" property="og:type" content="website" />
  
  <!-- Twitter Card -->
  <meta slot="head" name="twitter:card" content="summary_large_image" />
  <meta slot="head" name="twitter:title" content={seoTitle} />
  <meta slot="head" name="twitter:description" content={seoDescription} />
  <meta slot="head" name="twitter:image" content={seoImage} />
  
  <!-- JSON-LD Schema -->
  <script slot="head" type="application/ld+json" set:html={JSON.stringify(jsonLd)} />

  <div slot="content">
    <p class="text-xl text-gray-700 mb-8">{destino.descripcion}</p>

    {destino.historia && (
      <div class="my-12">
        <h2 class="text-3xl font-bold mb-6 text-forest-green">Historia</h2>
        <p class="text-lg text-gray-700 leading-relaxed">{destino.historia}</p>
      </div>
    )}
  </div>

  {destino.galeria && (
    <div class="my-12">
      <h2 class="text-3xl font-bold mb-6 text-forest-green">Galería de imágenes</h2>
      <ImageGallery images={destino.galeria} />
    </div>
  )}
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 my-12">
    <div class="bg-green-50 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4 text-forest-green">Qué incluye</h2>
      <ul class="list-disc list-inside space-y-2 text-gray-700">
        <li>Transporte privado desde tu alojamiento</li>
        <li>Guía local especializado</li>
        <li>Refrigerio durante el recorrido</li>
        <li>Seguro de viajero</li>
      </ul>
    </div>
    <div class="bg-green-50 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4 text-forest-green">Información importante</h2>
      <ul class="list-disc list-inside space-y-2 text-gray-700">
        <li>Duración aproximada: 4-6 horas</li>
        <li>Dificultad: Baja a moderada</li>
        <li>Ideal para familias y grupos</li>
        <li>Disponible todo el año</li>
      </ul>
    </div>
  </div>
  {destino.trasladosAvailable && (
    <div class="my-12">
      <DestinoConsultaForm destinoNombre={destino.nombre} destinoSlug={destino.slug} trasladosPrecio={destino.trasladosPrecio} />
    </div>
  )}
</DestinoLayout>